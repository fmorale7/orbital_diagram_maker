<!DOCTYPE html>
<html>
<head>
<title>Canvas Arrow</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    background-color: #f0f0f0;
  }
  canvas {
    border: 1px solid black;
    background-color: rgb(228, 228, 228);
  }
</style>
</head>
<body>
<!--   <div style="display: flex; flex-direction: column;">
    <button id="orbital">Place orbital</button>
    <button id="electron">Fill electron</button>
  </div> -->

  <canvas id="myCanvas" width="800" height="800"></canvas>

  <script>
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');

    const shapes = [ // houses orbital clickable areas
      { type: 'rectangle', x: 80-15, y: 200-35, width: 60, height: 40, color: 'rgba(10, 10, 10, 0.05)', state: 0 }
    ];

    function cycleState(shape){
      if (shape.state == 0){
        shape.state = 1
      } else if (shape.state == 1){
        shape.state = 2
      } else if (shape.state == 2){
        shape.state = 0
      } 
      console.log(shape.state)
    }

    let lastClickedButton = null;

    const buttons = document.querySelectorAll('button');

    buttons.forEach(button => {
      button.addEventListener('click', () => {
        lastClickedButton = button;
        console.log(`Last clicked button: ${lastClickedButton.id}`);
      });
    });

    function drawClickable() {
      let shape = shapes[shapes.length - 1]
      ctx.beginPath();
      ctx.rect(shape.x, shape.y, shape.width, shape.height);
      ctx.fillStyle = shape.color;
      ctx.fill();
      ctx.closePath();
    }

    function addClickArea(clickX, clickY) {
      let temp = {type: 'rectangle', x: clickX-35, y: clickY-15, width: 60, height: 40, color: 'rgba(10, 10, 10, 0.05)', state: 0};
      shapes.push(temp);
      // drawClickable();
      // drawLevel(clickX,clickY); 
    }

    function drawLevel(clickX, clickY) {
        ctx.beginPath();
        ctx.moveTo(clickX, clickY);
        ctx.lineTo(clickX + 30, clickY);
        ctx.stroke();
        drawClickable();
    }

    let canvasElem = document.querySelector("canvas");

    function isClickInside(shape, x, y) {
      if (shape.type === 'rectangle') {
        return x >= shape.x && x <= shape.x + shape.width && y >= shape.y && y <= shape.y + shape.height;
      }
      return false;
    }

    canvas.addEventListener('click', (event) => {
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      let flip = false;
      let arrow = false;
      arrowX = 0;
      arrowY = 0;

      shapes.forEach(shape => {
          if (!isClickInside(shape, x, y)) {
            flip = true;
          } else if (isClickInside(shape, x, y)){
            flip = false;
            arrow = true;
//x-20
            if (shape.state == 0) {
              drawArrow('up', shape.x - 5, shape.y + 15);
              cycleState(shape)
            } else if (shape.state == 1) {
              arrowX = shape.x + 15;
              arrowY = shape.y + 15;
              drawArrow('down', arrowX, arrowY);
              cycleState(shape)
            } else if (shape.state == 2) {
              ctx.clearRect(shape.x + 15, shape.y - 20, 30, 30)
              cycleState(shape)
            }
          }
      });

      if (flip == true && arrow == false) {
        addClickArea(x, y);
        drawLevel(x,y);
      }
      if (arrow == true){
        /*
        We clicked within existing level region, so I won't add a new one.
        I want to interact with existing, clicked level.
        Cycle:
          if empty orbital, add up arrow
          if already has up arrow, add down arrow
          if already has up and down, remove both. Restore to clear.
        */
        drawArrow('down', arrowX, arrowY);
      };
    });

    function drawArrow (dir, fromX, fromY, toX = fromX, headLength = 10){
      let toY = fromY;
      
      if (dir == 'up') {
        fromX = fromX + 10
        toX = toX + 10
        fromY = fromY - 5
        toY = fromY - 30
      } else if (dir == 'down') {
        fromX = fromX + 20
        toX = toX + 20
        fromY = fromY - 35
        toY = fromY + 30
      }

      const angle = Math.atan2(toY - fromY, toX - fromX);

      ctx.beginPath();
      ctx.moveTo(fromX, fromY);
      ctx.lineTo(toX, toY);

      ctx.moveTo(toX, toY);
      ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6)); // left head
      ctx.stroke();
      ctx.closePath();
    }

    drawLevel(80, 200);
    drawArrow('up', 80, 200);
    drawArrow('down', 80, 200);

  </script>
</body>
</html>