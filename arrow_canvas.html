<!DOCTYPE html>
<html>
<head>
<title>Canvas Arrow</title>
<style>
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    background-color: #f0f0f0;
  }
  canvas {
    border: 1px solid black;
    background-color: rgb(228, 228, 228);
  }
</style>
</head>
<body>
  <canvas id="myCanvas" width="800" height="800"></canvas>
  <script>
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');

    // Minimal constants. All objects defined by click coordinates.
    let orbLen = 30;
    let arOrbGap = 5;
    let arLen = 30;

    const clickPt = [{}]; // new house click instances
    // {x, y, state, visible}

    const shapes = [{}]; // houses orbital clickable areas
    
    // true if click is within existing box, false if out
    // To cycle orb state.
    function isClickInside(shape, x, y) {
      return x >= shape.x && x <= shape.x + orbLen && y >= shape.y - arOrbGap - arLen && y <= shape.y + arOrbGap + arLen;
    }

    // To prevent shape overlap.
    function placeOrb(shape,x,y) {
      return x <= shape.x - orbLen && x >= shape.x + orbLen && y <= shape.y - arOrbGap - arLen && y >= shape.y + arOrbGap + arLen;
    }

    // draw new orbital
    function drawLevel(clickX, clickY) {
        ctx.beginPath();
        ctx.moveTo(clickX, clickY);
        ctx.lineTo(clickX + orbLen, clickY);
        ctx.stroke();
        drawClickable();
    }

    canvas.addEventListener('click', (event) => {
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      let flip = false;
      let arrow = false;

      shapes.forEach(shape => {
          if (!isClickInside(shape, x, y)) {
            flip = true;
          } else if (isClickInside(shape, x, y)){
            flip = false;
            arrow = true;
            /*
            We clicked within existing level region, so I won't add a new one.
            I want to interact with existing, clicked level.
            Cycle:
              if empty orbital, add up arrow
              if already has up arrow, add down arrow
              if already has up and down, remove both. Restore to clear.
            */
            if (shape.state == 0) {
              drawArrow('up', shape.x, shape.y);
              cycleState(shape)
            } else if (shape.state == 1) {
              drawArrow('down', shape.x, shape.y);
              cycleState(shape)
            } else if (shape.state == 2) {
              ctx.clearRect(shape.x, shape.y, 30, 38)
              cycleState(shape)
            }
          }
      });
//////////////////////
      // Redefine arrow drawing coords wrt clicked coords.
      // Include state parameter, toggles transparency
      function drawArrow (dir, fromX, fromY, toX = fromX, headLength = 10, state = 0){
        let toY = fromY;
        
        if (dir == 'up') {
          fromX = fromX + orbLen/3
          toX = toX + orbLen/3
          fromY = fromY - arOrbGap
          toY = toY - arOrbGap - arLen
        } else if (dir == 'down') {
          fromX = fromX + orbLen*2/3
          toX = fromX
          fromY = fromY - arOrbGap - arLen
          toY = toY - arOrbGap
          
        }

        const angle = Math.atan2(toY - fromY, toX - fromX);

        ctx.beginPath();
        ctx.moveTo(fromX, fromY);
        ctx.lineTo(toX, toY);

        ctx.moveTo(toX, toY);
        ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6)); // left head
        ctx.stroke();
        ctx.closePath();
      }
////////////////////////
      if (flip == true && arrow == false) {
        addClickArea(x, y);
        drawLevel(x,y);
      }
    });

    function cycleState(shape){
      if (shape.state == 0){
        shape.state = 1
      } else if (shape.state == 1){
        shape.state = 2
      } else if (shape.state == 2){
        shape.state = 0
      } 
      console.log(shape.state)
    }

    let lastClickedButton = null;
    const buttons = document.querySelectorAll('button');

    function drawClickable() {
      let shape = shapes[shapes.length - 1]
      ctx.beginPath();
      ctx.rect(shape.x, shape.y, shape.width, shape.height);
      ctx.fillStyle = shape.color;
      ctx.fill();
      ctx.closePath();
    }

    function addClickArea(clickX, clickY) {
      let temp = {x: clickX, y: clickY, width: orbLen, height: arLen + arOrbGap, color: 'rgba(10, 10, 10, 0.00)', state: 0};
      shapes.push(temp);
      clickPt.push({x: clickX, y: clickY, state: 0});
    }

    let canvasElem = document.querySelector("canvas");



  </script>
</body>
</html>




